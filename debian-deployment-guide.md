# ðŸš€ Complete Debian Deployment Guide
## India Engineering Works Website

### Prerequisites
- Debian 11/12 server with root access
- Domain name (e.g., indiaengineeringworks.com)
- Domain DNS pointing to your server IP

---

## Step 1: Initial Server Setup

### Connect to your server:
```bash
ssh root@your-server-ip
# or
ssh user@your-server-ip
sudo su -
```

### Update system:
```bash
apt update && apt upgrade -y
apt install curl wget unzip nginx certbot python3-certbot-nginx ufw -y
```

---

## Step 2: Configure Domain DNS

### A Records to add in your domain registrar:
```
Type: A
Name: @
Value: YOUR_SERVER_IP
TTL: 3600

Type: A  
Name: www
Value: YOUR_SERVER_IP
TTL: 3600
```

### Verify DNS propagation:
```bash
# Check from your server
nslookup your-domain.com
nslookup www.your-domain.com

# Should return your server IP
```

---

## Step 3: Prepare Website Files

### Create directories:
```bash
mkdir -p /var/www/india-engineering-works
mkdir -p /tmp/website-deploy
```

### Upload your files (from your local machine):
```bash
# Option 1: Using SCP
scp -r dist/* root@your-server-ip:/tmp/website-deploy/

# Option 2: Using rsync (recommended)
rsync -avz --progress dist/ root@your-server-ip:/tmp/website-deploy/

# Option 3: Direct download (if files are hosted)
# wget -O website.zip https://your-file-host.com/website.zip
# unzip website.zip -d /tmp/website-deploy/
```

### Copy files to web directory:
```bash
cp -r /tmp/website-deploy/* /var/www/india-engineering-works/
chown -R www-data:www-data /var/www/india-engineering-works/
chmod -R 755 /var/www/india-engineering-works/
```

---

## Step 4: Configure nginx

### Create nginx configuration:
```bash
nano /etc/nginx/sites-available/india-engineering-works
```

### Paste this configuration (replace YOUR-DOMAIN.COM):
```nginx
# HTTP server (temporary - will redirect to HTTPS after SSL setup)
server {
    listen 80;
    listen [::]:80;
    server_name your-domain.com www.your-domain.com;
    
    root /var/www/india-engineering-works;
    index index.html index.htm;
    
    # Handle React Router (SPA routing)
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # Admin route
    location /admin {
        try_files $uri $uri/ /index.html;
    }
    
    # Security - deny hidden files
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/x-javascript
        application/xml+rss
        application/javascript
        application/json
        image/svg+xml;
}
```

### Enable the site:
```bash
# Create symbolic link
ln -s /etc/nginx/sites-available/india-engineering-works /etc/nginx/sites-enabled/

# Remove default site
rm -f /etc/nginx/sites-enabled/default

# Test nginx configuration
nginx -t

# Restart nginx
systemctl restart nginx
systemctl enable nginx
```

---

## Step 5: Configure Firewall

```bash
# Allow SSH, HTTP, and HTTPS
ufw allow ssh
ufw allow 80/tcp
ufw allow 443/tcp

# Enable firewall
ufw --force enable

# Check status
ufw status
```

---

## Step 6: Test HTTP Access

```bash
# Test from server
curl -I http://your-domain.com

# Should return 200 OK with HTML content
```

**Visit:** `http://your-domain.com` - Your website should be live!

---

## Step 7: Setup SSL Certificate (Let's Encrypt)

### Get SSL certificate:
```bash
# Replace with your actual domain
certbot --nginx -d your-domain.com -d www.your-domain.com

# Follow the prompts:
# 1. Enter email address
# 2. Agree to terms (A)
# 3. Share email with EFF (Y/N - your choice)
# 4. Choose redirect option (2 - Redirect HTTP to HTTPS)
```

### Verify SSL:
```bash
# Test SSL certificate
curl -I https://your-domain.com

# Check certificate details
openssl s_client -connect your-domain.com:443 -servername your-domain.com
```

---

## Step 8: Final nginx Configuration (Post-SSL)

### Your nginx config will be automatically updated by Certbot, but here's the complete version:

```bash
nano /etc/nginx/sites-available/india-engineering-works
```

```nginx
# HTTP redirect to HTTPS
server {
    listen 80;
    listen [::]:80;
    server_name your-domain.com www.your-domain.com;
    return 301 https://$server_name$request_uri;
}

# HTTPS server
server {
    listen 443 ssl http2;
    listen [::]:443 ssl http2;
    server_name your-domain.com www.your-domain.com;
    
    # SSL Configuration (auto-generated by Certbot)
    ssl_certificate /etc/letsencrypt/live/your-domain.com/fullchain.pem;
    ssl_certificate_key /etc/letsencrypt/live/your-domain.com/privkey.pem;
    include /etc/letsencrypt/options-ssl-nginx.conf;
    ssl_dhparam /etc/letsencrypt/ssl-dhparams.pem;
    
    # Document root
    root /var/www/india-engineering-works;
    index index.html index.htm;
    
    # Security headers
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-Content-Type-Options "nosniff" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header Referrer-Policy "no-referrer-when-downgrade" always;
    add_header Content-Security-Policy "default-src 'self' https://firebaseapp.com https://*.firebaseapp.com https://firebase.googleapis.com https://*.googleapis.com 'unsafe-inline' 'unsafe-eval'" always;
    add_header Strict-Transport-Security "max-age=31536000; includeSubDomains" always;
    
    # Handle React Router (SPA routing)
    location / {
        try_files $uri $uri/ /index.html;
    }
    
    # Cache static assets
    location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {
        expires 1y;
        add_header Cache-Control "public, immutable";
        access_log off;
    }
    
    # Admin route (optional password protection)
    location /admin {
        # Uncomment for basic auth:
        # auth_basic "Admin Area";
        # auth_basic_user_file /etc/nginx/.htpasswd;
        try_files $uri $uri/ /index.html;
    }
    
    # Security
    location ~ /\. {
        deny all;
        access_log off;
        log_not_found off;
    }
    
    # Gzip compression
    gzip on;
    gzip_vary on;
    gzip_min_length 1024;
    gzip_proxied expired no-cache no-store private must-revalidate auth;
    gzip_types
        text/plain
        text/css
        text/xml
        text/javascript
        application/x-javascript
        application/xml+rss
        application/javascript
        application/json
        image/svg+xml;
}
```

### Test and reload:
```bash
nginx -t
systemctl reload nginx
```

---

## Step 9: Setup Auto-renewal for SSL

```bash
# Test renewal
certbot renew --dry-run

# Add to crontab for auto-renewal
crontab -e

# Add this line:
0 12 * * * /usr/bin/certbot renew --quiet
```

---

## Step 10: Monitoring & Maintenance

### Useful commands:
```bash
# Check nginx status
systemctl status nginx

# View nginx logs
tail -f /var/log/nginx/access.log
tail -f /var/log/nginx/error.log

# Check SSL certificate expiry
certbot certificates

# Restart services
systemctl restart nginx

# Check website
curl -I https://your-domain.com
```

### Performance monitoring:
```bash
# Install monitoring tools
apt install htop iotop nethogs -y

# Monitor server resources
htop
```

---

## ðŸŽ‰ Deployment Complete!

### Your website is now live at:
- **HTTP:** `http://your-domain.com` (redirects to HTTPS)
- **HTTPS:** `https://your-domain.com` âœ…
- **Admin:** `https://your-domain.com/admin`

### Next Steps:
1. âœ… Website deployed with SSL
2. âœ… Automatic HTTP to HTTPS redirect
3. âœ… Security headers configured
4. âœ… Auto-renewal setup for SSL
5. ðŸ”„ Monitor performance and logs

### Troubleshooting:
- **DNS issues:** Check domain registrar DNS settings
- **SSL issues:** Run `certbot certificates` and check logs
- **nginx issues:** Check `nginx -t` and error logs
- **File permissions:** Ensure `www-data` owns web files

### Support:
- nginx docs: https://nginx.org/en/docs/
- Let's Encrypt: https://letsencrypt.org/docs/
- Certbot: https://certbot.eff.org/
